<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>聊聊图片预览的两种方法 | YF的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/cat.png">
    <meta name="description" content="A front end blog developed by YF">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.75dc69ab.js" as="script"><link rel="preload" href="/assets/js/2.a673c79f.js" as="script"><link rel="preload" href="/assets/js/14.781c2e57.js" as="script"><link rel="prefetch" href="/assets/js/10.23fbdd11.js"><link rel="prefetch" href="/assets/js/11.7edc89c0.js"><link rel="prefetch" href="/assets/js/12.16a82503.js"><link rel="prefetch" href="/assets/js/13.a28e4b8f.js"><link rel="prefetch" href="/assets/js/15.16cf6885.js"><link rel="prefetch" href="/assets/js/3.7ec632bc.js"><link rel="prefetch" href="/assets/js/4.7adb1798.js"><link rel="prefetch" href="/assets/js/5.d3359473.js"><link rel="prefetch" href="/assets/js/6.5eff19f1.js"><link rel="prefetch" href="/assets/js/7.b7bb35e8.js"><link rel="prefetch" href="/assets/js/8.338e4b9d.js"><link rel="prefetch" href="/assets/js/9.3842a138.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/YF.png" alt="YF的博客" class="logo"> <span class="site-name can-hide">YF的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS基本功" class="dropdown-title"><span class="title">JS基本功</span> <span class="arrow down"></span></button> <button type="button" aria-label="JS基本功" class="mobile-dropdown-title"><span class="title">JS基本功</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JS/garbageCollect.html" class="nav-link">
  聊聊JS垃圾回收机制
</a></li><li class="dropdown-item"><!----> <a href="/JS/shallow&amp;deepClone.html" class="nav-link">
  聊聊Javascript里的深浅拷贝
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTTP网络" class="dropdown-title"><span class="title">HTTP网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="HTTP网络" class="mobile-dropdown-title"><span class="title">HTTP网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/HTTP/crossOrigin.html" class="nav-link">
  从cookie讲到跨域
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="最佳实践" class="dropdown-title"><span class="title">最佳实践</span> <span class="arrow down"></span></button> <button type="button" aria-label="最佳实践" class="mobile-dropdown-title"><span class="title">最佳实践</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/practice/picturePreview.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  聊聊图片预览的两种方法
</a></li><li class="dropdown-item"><!----> <a href="/practice/toString.html" class="nav-link">
  巧用Javascript的toString方法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/sort.html" class="nav-link">
  介绍一下各种排序算法
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/CathyZYF/CathyZYF.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS基本功" class="dropdown-title"><span class="title">JS基本功</span> <span class="arrow down"></span></button> <button type="button" aria-label="JS基本功" class="mobile-dropdown-title"><span class="title">JS基本功</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JS/garbageCollect.html" class="nav-link">
  聊聊JS垃圾回收机制
</a></li><li class="dropdown-item"><!----> <a href="/JS/shallow&amp;deepClone.html" class="nav-link">
  聊聊Javascript里的深浅拷贝
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTTP网络" class="dropdown-title"><span class="title">HTTP网络</span> <span class="arrow down"></span></button> <button type="button" aria-label="HTTP网络" class="mobile-dropdown-title"><span class="title">HTTP网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/HTTP/crossOrigin.html" class="nav-link">
  从cookie讲到跨域
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="最佳实践" class="dropdown-title"><span class="title">最佳实践</span> <span class="arrow down"></span></button> <button type="button" aria-label="最佳实践" class="mobile-dropdown-title"><span class="title">最佳实践</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/practice/picturePreview.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  聊聊图片预览的两种方法
</a></li><li class="dropdown-item"><!----> <a href="/practice/toString.html" class="nav-link">
  巧用Javascript的toString方法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/sort.html" class="nav-link">
  介绍一下各种排序算法
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/CathyZYF/CathyZYF.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/practice/picturePreview.html" aria-current="page" class="active sidebar-link">聊聊图片预览的两种方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/practice/picturePreview.html#一、上传文件之前的样式优化" class="sidebar-link">一、上传文件之前的样式优化</a></li><li class="sidebar-sub-header"><a href="/practice/picturePreview.html#二、用filereader实现图片预览" class="sidebar-link">二、用FileReader实现图片预览</a></li><li class="sidebar-sub-header"><a href="/practice/picturePreview.html#三、利用url-createobjecturl-实现图片预览" class="sidebar-link">三、利用URL.createObjectURL()实现图片预览</a></li><li class="sidebar-sub-header"><a href="/practice/picturePreview.html#四、两种方法的差异" class="sidebar-link">四、两种方法的差异</a></li></ul></li><li><a href="/practice/toString.html" class="sidebar-link">巧用Javascript的toString方法</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="聊聊图片预览的两种方法"><a href="#聊聊图片预览的两种方法" class="header-anchor">#</a> 聊聊图片预览的两种方法</h1> <p>在我们的前端业务中，经常需要上传图片并且预览出一张略缩图，在以前的实现中，往往需要借助后端的力量，在上传完毕后获取对应资源的链接，再在前端展示出来。这种方法本质上是&quot;先上传，后预览&quot;，违背了我们的初衷。为此，我们可以通过特定的web API来实现这一功能。</p> <p>今天要介绍的两种方法，分别是<code>File Reader</code>和<code>URL.createObjectURL()</code></p> <h2 id="一、上传文件之前的样式优化"><a href="#一、上传文件之前的样式优化" class="header-anchor">#</a> 一、上传文件之前的样式优化</h2> <p>在MDN中有这样一段描述：</p> <div class="language- extra-class"><pre><code>You can hide the admittedly ugly file &lt;input&gt; element and present your own interface for opening the file picker 
and displaying which file or files the user has selected. You can do this by styling the input element with 
display:none and calling the click() method on the &lt;input&gt; element.
</code></pre></div><p>这段话的意思，除了吐槽html中原始的file &lt;input&gt;控件着实难看，也给出了实现一个自定义样式的文件上传控件的思路：</p> <ol><li>先将原始的input空间利用display:none在页面中隐藏。</li> <li>自定义一个上传控件，它可以是一个按钮，a标签或是任何你希望的元素</li> <li>在自定义的上传控件上绑定一个事件，在此事件的回调中获取原始的input元素，并手动调用input元素的click方法</li> <li>在input元素上绑定一个onchange事件，用来处理选择文件后的回调函数。</li></ol> <p>下面，我将利用Vue代码实现这个功能：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    	<span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> @change<span class="token operator">=</span><span class="token string">&quot;fileChange&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> multiple accept<span class="token operator">=</span><span class="token string">&quot;.csv&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;display: none&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>el<span class="token operator">-</span>button  type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;clickTrigger&quot;</span><span class="token operator">&gt;</span>选择<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  	methods<span class="token operator">:</span><span class="token punctuation">{</span>
    	  <span class="token function">clickTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          	<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token function">fileChange</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          	<span class="token keyword">let</span> newFiles <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">)</span>
                newFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">newFile</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                   <span class="token comment">// 对每个newFile做点事情</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="二、用filereader实现图片预览"><a href="#二、用filereader实现图片预览" class="header-anchor">#</a> 二、用FileReader实现图片预览</h2> <p>引用MDN上的原话：</p> <div class="language- extra-class"><pre><code>FileReader 对象异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。
其中File对象可以是来自用户在一个`&lt;input&gt;`元素上选择文件后返回的FileList对象,也可以来自拖放操作生成的 `DataTransfer`对象,
还可以是来自在一个`HTMLCanvasElement`上执行`mozGetAsFile()`方法后返回结果。
</code></pre></div><p>在我们这篇文章中，先只考虑第一种情况,即用户选择文件后返回的FileList对象。让我们来熟悉一下FileReader：</p> <p>首先，FileReader是一个类，返回一个fileReader实例，利用这个实例即可读取FileList里的File对象。在fileReader实例上，有一个<code>readAsDataURL()</code>方法，该方法读取指定的File对象，在读取文件完毕后，可以在fileReader的onload事件里获取返回结果。利用<code>readAsDataURL</code>方法，获取的返回结果是一个data: URL格式的Base64字符串，这个字符串可以直接放置在<code>&lt;img&gt;</code>标签的src属性中，这样一来，就得到了前端预览图片的第一种思路。</p> <p>以下是代码实现：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    	<span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> @change<span class="token operator">=</span><span class="token string">&quot;fileChange&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> multiple accept<span class="token operator">=</span><span class="token string">&quot;.csv&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;display: none&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>el<span class="token operator">-</span>button  type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;clickTrigger&quot;</span><span class="token operator">&gt;</span>选择<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token string">'thumbnails'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            dataSrc<span class="token operator">:</span><span class="token string">''</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  	methods<span class="token operator">:</span><span class="token punctuation">{</span>
    	  <span class="token function">clickTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          	<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token function">fileChange</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          	<span class="token keyword">let</span> newFiles <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">)</span>
                newFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">newFile</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                   <span class="token keyword">let</span> fr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                   fr<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>newFile<span class="token punctuation">)</span>
                   fr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">let</span> dataURL <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
                        <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        img<span class="token punctuation">.</span>src <span class="token operator">=</span> dataURL
                        <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>thumbnails<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
            	   <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="三、利用url-createobjecturl-实现图片预览"><a href="#三、利用url-createobjecturl-实现图片预览" class="header-anchor">#</a> 三、利用URL.createObjectURL()实现图片预览</h2> <p>先来介绍一下URL这个类。URL类用来解析和构造url，在URL类中传入一个url字符串，将返回一个实例，这个实例中包含能让你轻松访问和修改该url的属性。</p> <p>该类的兼容性不佳，IE10以上的版本中只支持createObjectURL和revokeObjectURL两个静态方法。不过对于我们今天的主题来说，URL.createObjectURL是勉强合格的（兼容IE10及以上）</p> <p>不同于异步的FileReader，该方法同步返回一个带Hash的url，并且，URL对象的生命周期是和document绑定的，如果我们不手动调用revokeObjectURL清除这部分内存，它将存活至该页面关闭。</p> <p>下面给出实现代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    	<span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> @change<span class="token operator">=</span><span class="token string">&quot;fileChange&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> multiple accept<span class="token operator">=</span><span class="token string">&quot;.csv&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;display: none&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>el<span class="token operator">-</span>button  type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;clickTrigger&quot;</span><span class="token operator">&gt;</span>选择<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token string">'thumbnails'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            dataSrc<span class="token operator">:</span><span class="token string">''</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  	methods<span class="token operator">:</span><span class="token punctuation">{</span>
    	  <span class="token function">clickTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          	<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token function">fileChange</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          	<span class="token keyword">let</span> newFiles <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">)</span>
                newFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">newFile</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        		 <span class="token keyword">let</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        		 image<span class="token punctuation">.</span>src <span class="token operator">=</span> url
        		 <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>thumbnails<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
                 image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="四、两种方法的差异"><a href="#四、两种方法的差异" class="header-anchor">#</a> 四、两种方法的差异</h2> <ol><li>FileReader的结果是异步返回的，而createObjectURL是同步的</li> <li>返回结果不同，FileReader返回的是一个base64编码的字符串，一般来说体积较大；而createObjectURL返回的是一个带hash的url,相对前者来说较小</li> <li>生命周期不同，FileReader返回结果后会自动释放内存，而createObjectURL需要手动释放内存</li> <li>createObjectURL出来用来预览图片，还可以获取pdf,video等其他格式的文件。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/practice/toString.html">
        巧用Javascript的toString方法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.75dc69ab.js" defer></script><script src="/assets/js/2.a673c79f.js" defer></script><script src="/assets/js/14.781c2e57.js" defer></script>
  </body>
</html>
